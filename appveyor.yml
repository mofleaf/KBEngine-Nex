# ===============================
# AppVeyor CI 配置
# ===============================
shallow_clone: true

branches:
  only:
    - master
    - appveyor

# ===============================
# Job 定义
# ===============================
jobs:
  # -------------------------------
  # Windows 构建 (Visual Studio 2022)
  # -------------------------------
  - job_name: windows_vs2022
    image: Visual Studio 2022
    environment:
      TOOLSET: vs2022
    build_script:
      - cmd: call install_windows.bat

  # -------------------------------
  # Linux 构建 (Ubuntu 22.04)
  # 拆分为 3 个 step 串行执行
  # -------------------------------
  - job_name: linux_build
    image: Ubuntu2204
    build_script:
      # Step 1: 安装系统工具和依赖
      - sh: bash install_linux_step1_deps.sh

      # Step 2: 下载 vcpkg 并执行 cmake configure
      - sh: bash install_linux_step2_configure.sh Release

      # Step 3: 编译
      - sh: bash install_linux_step3_build.sh